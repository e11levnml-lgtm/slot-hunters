<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>TrustVia — Кошелёк</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root {
      --accent: #00d676;
      --accent-dark: #00b35e;
      --bg: #0b0b0b;
      --card: #141414;
      --positive: #00ff9d;
      --negative: #ff4d4d;
    }

    body {
      background: linear-gradient(135deg, var(--bg) 0%, #121212 100%);
      color: white;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      margin: 0;
      height: 100dvh;
      display: flex;
      flex-direction: column;
      overflow: hidden;
      overscroll-behavior: none;
    }

    header {
      background: rgba(11, 11, 11, 0.94);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      padding: clamp(12px, 4vw, 16px) clamp(16px, 5vw, 24px);
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 1px solid rgba(255,255,255,0.06);
      position: sticky;
      top: 0;
      z-index: 50;
    }

    .brand {
      font-size: clamp(24px, 7vw, 32px);
      font-weight: 900;
      background: linear-gradient(90deg, var(--accent), #00ff9d);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .avatar-btn {
      width: clamp(44px, 12vw, 52px);
      height: clamp(44px, 12vw, 52px);
      background: linear-gradient(135deg, var(--accent), #00ff9d);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      font-size: clamp(20px, 6vw, 24px);
      cursor: pointer;
      border: 3px solid rgba(0,214,118,0.5);
      box-shadow: 0 0 20px rgba(0,214,118,0.4);
      transition: all 0.3s ease;
    }

    .avatar-btn:active {
      transform: scale(0.92);
      box-shadow: 0 0 30px rgba(0,214,118,0.6);
    }

    .balance-section {
      text-align: center;
      padding: clamp(32px, 10vh, 48px) clamp(20px, 6vw, 32px) clamp(24px, 8vh, 32px);
      animation: fadeIn 1.2s ease;
    }

    .balance {
      font-size: clamp(48px, 14vw, 68px);
      font-weight: 900;
      letter-spacing: -3px;
      background: linear-gradient(90deg, #ffffff, #e0e0e0);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      line-height: 1;
    }

    .change {
      font-size: clamp(22px, 6vw, 28px);
      font-weight: 700;
      margin-top: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    .change-positive { color: var(--positive); }
    .change-negative { color: var(--negative); }
    .change-neutral   { color: #aaa; }

    .action-buttons {
      display: flex;
      justify-content: space-around;
      padding: clamp(24px, 6vh, 32px) clamp(16px, 5vw, 24px);
      background: rgba(0,0,0,0.3);
      backdrop-filter: blur(8px);
    }

    .action-btn {
      width: clamp(80px, 22vw, 90px);
      height: clamp(80px, 22vw, 90px);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: clamp(36px, 10vw, 42px);
      box-shadow: 0 10px 40px rgba(0,0,0,0.6);
      transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
      cursor: pointer;
      user-select: none;
    }

    .action-btn.green {
      background: linear-gradient(135deg, var(--accent), #00ff9d);
      color: black;
      box-shadow: 0 10px 40px rgba(0,214,118,0.5);
    }

    .action-btn:active {
      transform: scale(0.9) translateY(4px);
      box-shadow: 0 4px 20px rgba(0,0,0,0.5);
    }

    .tabs {
      display: flex;
      background: rgba(11,11,11,0.92);
      backdrop-filter: blur(12px);
      border-bottom: 1px solid #1a1a1a;
      position: sticky;
      top: clamp(60px, 15vh, 80px);
      z-index: 40;
    }

    .tab {
      flex: 1;
      text-align: center;
      padding: clamp(14px, 4vw, 20px) 0;
      font-weight: 700;
      font-size: clamp(16px, 4.5vw, 18px);
      cursor: pointer;
      transition: all 0.3s;
      position: relative;
    }

    .tab-active {
      color: var(--accent);
    }

    .tab-active::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 60%;
      height: 4px;
      background: linear-gradient(90deg, var(--accent), #00ff9d);
      border-radius: 4px 4px 0 0;
    }

    .hide-scroll {
      -ms-overflow-style: none;
      scrollbar-width: none;
    }

    .hide-scroll::-webkit-scrollbar {
      display: none;
    }

    .content {
      flex: 1;
      overflow-y: auto;
      padding: clamp(16px, 5vw, 24px);
      padding-bottom: env(safe-area-inset-bottom, 20px);
    }

    .token-row, .tx-item {
      background: linear-gradient(to right, var(--card), #1a1a1a);
      border-radius: 24px;
      padding: clamp(16px, 5vw, 24px);
      margin-bottom: clamp(16px, 4vh, 24px);
      display: flex;
      align-items: center;
      justify-content: space-between;
      transition: all 0.3s ease;
      cursor: pointer;
      border: 1px solid #222;
    }

    .token-row:active, .tx-item:active {
      transform: translateY(-4px);
      border-color: var(--accent);
      box-shadow: 0 12px 40px rgba(0,214,118,0.25);
    }

    .token-icon {
      width: clamp(56px, 15vw, 72px);
      height: clamp(56px, 15vw, 72px);
      border-radius: 50%;
      box-shadow: 0 0 24px rgba(0,214,118,0.3);
    }

    .modal {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.9);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 100;
      backdrop-filter: blur(12px);
    }

    .modal-content {
      background: linear-gradient(to bottom, var(--card), #0c0c0c);
      border-radius: 36px;
      padding: clamp(40px, 10vw, 56px) clamp(24px, 6vw, 36px);
      width: 92%;
      max-width: 420px;
      text-align: center;
      border: 1px solid #333;
      box-shadow: 0 24px 80px rgba(0,0,0,0.9);
    }

    .modal-avatar {
      width: clamp(100px, 30vw, 140px);
      height: clamp(100px, 30vw, 140px);
      background: linear-gradient(135deg, var(--accent), #00ff9d);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: clamp(48px, 14vw, 64px);
      font-weight: bold;
      color: black;
      margin: 0 auto 32px;
      box-shadow: 0 0 48px rgba(0,214,118,0.6);
    }

    .modal-btn {
      background: linear-gradient(135deg, #1a1a1a, #222);
      color: white;
      padding: clamp(16px, 5vw, 20px);
      border-radius: 9999px;
      font-weight: bold;
      width: 100%;
      margin-bottom: 20px;
      transition: all 0.3s;
      box-shadow: 0 6px 24px rgba(0,0,0,0.5);
      cursor: pointer;
    }

    .modal-btn:active {
      transform: translateY(3px);
    }

    .modal-btn.red {
      background: linear-gradient(135deg, #ff4d4d, #ff1a1a);
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    @media (prefers-reduced-motion: reduce) {
      * { animation: none !important; transition: none !important; transform: none !important; }
    }
  </style>
</head>
<body>
  <header>
    <div class="flex items-center gap-4 sm:gap-6">
      <div class="w-10 h-10 sm:w-12 sm:h-12 rounded-full bg-gradient-to-br from-blue-600 to-purple-700 flex items-center justify-center text-sm sm:text-base font-bold shadow-xl ring-2 ring-white/20">
        ETH
      </div>
      <div class="brand">TrustVia</div>
    </div>
    <div onclick="openModal()" class="avatar-btn" aria-label="Профиль">С</div>
  </header>

  <section class="balance-section">
    <h1 id="total-usd" class="balance">0.00 $</h1>
    <div id="change-24h" class="change">
      0.00%
      <svg class="w-6 h-6 sm:w-8 sm:h-8 text-neutral-400" fill="currentColor" viewBox="0 0 20 20">
        <path d="M10 3l-7 7h4v7h6v-7h4l-7-7z" />
      </svg>
    </div>
  </section>

  <div class="action-buttons">
    <div onclick="location.href='send.html'" class="action-btn" aria-label="Отправить">↑</div>
    <div onclick="location.href='receive.html'" class="action-btn green" aria-label="Получить">↓</div>
    <div onclick="location.href='swap.html'" class="action-btn" aria-label="Обмен">⇄</div>
  </div>

  <nav class="tabs">
    <div id="tab-assets" class="tab tab-active" onclick="switchTab('assets')">Активы</div>
    <div id="tab-history" class="tab" onclick="switchTab('history')">История</div>
  </nav>

  <main class="content hide-scroll" id="assets-list"></main>
  <main class="content hide-scroll hidden" id="history-list"></main>

  <!-- Модальное окно профиля -->
  <div id="modal" class="modal" onclick="closeModal(event)">
    <div class="modal-content" onclick="event.stopPropagation()">
      <div class="modal-avatar">С</div>
      <h2 class="text-3xl sm:text-4xl font-extrabold mb-4">Сергей</h2>
      <p class="text-zinc-400 mb-10 text-xl sm:text-2xl">@Сергей</p>
      <div class="modal-btn" onclick="navigator.clipboard.writeText('0xc519118cd0c74879bd3FbF5fEaca473397540862').then(() => alert('Адрес скопирован!'))">
        Скопировать адрес
      </div>
      <div class="modal-btn" onclick="alert('Seed-фраза показывается только один раз при создании. Храните её в безопасном месте!')">
        Посмотреть seed
      </div>
      <div class="modal-btn red" onclick="logout()">Выйти из аккаунта</div>
      <div class="mt-10 text-zinc-400 cursor-pointer hover:text-zinc-200 text-lg sm:text-xl" onclick="closeModal()">Закрыть</div>
    </div>
  </div>

  <script>
    if (!localStorage.getItem('mnemonic')) {
      window.location.href = 'auth.html';
    }

    const walletAddress = '0xc519118cd0c74879bd3FbF5fEaca473397540862';
    localStorage.setItem('walletAddress', walletAddress);

    const tokens = [
      { id:'WBTC', name:'Wrapped Bitcoin', bal:0.3541, s:'wbtc', p:'WBTCUSDT' },
      { id:'USDT', name:'Tether USD', bal:20000, s:'usdt', p:'USDTUSDT' },
      { id:'ETH', name:'Ethereum', bal:0.12, s:'eth', p:'ETHUSDT' },
      { id:'USDC', name:'USD Coin', bal:0, s:'usdc', p:'USDCUSDT' },
      { id:'LINK', name:'Chainlink', bal:0, s:'link', p:'LINKUSDT' },
      // ... остальные токены (можно добавить)
    ];

    async function updateBalance() {
      const balanceEl = document.getElementById('total-usd');
      balanceEl.style.opacity = '0.6';
      try {
        const res = await fetch('https://api.binance.com/api/v3/ticker/price?symbols=["ETHUSDT","WBTCUSDT","USDTUSDT"]'); // только нужные для скорости
        if (!res.ok) throw new Error('API error');
        const prices = await res.json();
        let total = 0;
        let html = '';

        tokens.forEach(t => {
          let price = 1;
          if (t.p !== 'USDTUSDT') {
            const pData = prices.find(p => p.symbol === t.p);
            price = pData ? parseFloat(pData.price) : 0;
          }
          const val = t.bal * price;
          total += val;

          html += `
            <div onclick="location.href='chart.html?id=${t.id}&bal=${t.bal}&sym=${t.p}&icon=${t.s}'"
                 class="token-row">
              <div class="flex items-center gap-5 sm:gap-7">
                <img src="https://assets.coincap.io/assets/icons/${t.s}@2x.png"
                     onerror="this.src='https://via.placeholder.com/72?text=${t.id}'"
                     class="token-icon" alt="${t.id}">
                <div>
                  <p class="font-bold text-xl sm:text-3xl">$ ${val.toLocaleString('ru-RU', {minimumFractionDigits: 2, maximumFractionDigits: 2})}</p>
                  <p class="text-base sm:text-lg text-zinc-400">${t.bal.toFixed(4)} ${t.id}</p>
                </div>
              </div>
              <div class="text-right">
                <p class="font-bold text-xl sm:text-3xl">$ ${val.toLocaleString('ru-RU', {minimumFractionDigits: 2, maximumFractionDigits: 2})}</p>
              </div>
            </div>`;
        });

        balanceEl.textContent = total.toLocaleString('ru-RU', {minimumFractionDigits: 2, maximumFractionDigits: 2}) + ' $';
        balanceEl.style.opacity = '1';

        const change24h = (Math.random() * 8 - 4).toFixed(2); // демо
        const changeEl = document.getElementById('change-24h');
        changeEl.innerHTML = `
          ${change24h > 0 ? '+' : ''}${change24h}%
          <svg class="w-6 h-6 sm:w-8 sm:h-8 ${change24h > 0 ? 'change-positive' : change24h < 0 ? 'change-negative' : 'change-neutral'}" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="${change24h > 0 ? 'M5.293 9.707a1 1 0 010-1.414l4-4a1 1 0 011.414 0l4 4a1 1 0 01-1.414 1.414L11 7.414V15a1 1 0 11-2 0V7.414L6.707 9.707a1 1 0 01-1.414 0z' : 'M14.707 10.293a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 111.414-1.414L9 12.586V5a1 1 0 112 0v7.586l3.293-3.293a1 1 0 011.414 0z'}" clip-rule="evenodd" />
          </svg>
        `;
      } catch (e) {
        console.error('Ошибка цен:', e);
        balanceEl.textContent = 'Ошибка загрузки...';
      }
    }

    function generateHistory() {
      // Твой массив транзакций (оставил как есть, но улучшил стили)
      const fixedTransactions = [ /* ... твой массив ... */ ]; // вставь свой массив сюда

      let html = '';
      fixedTransactions.forEach(tx => {
        let iconColor = tx.type.includes("Отправлено") ? 'text-red-500' :
                        tx.type.includes("Получено") || tx.type.includes("Пополнение") ? 'text-green-500' :
                        tx.type.includes("Обмен") ? 'text-blue-500' : 'text-gray-500';

        let iconPath = tx.type.includes("Отправлено") ? 'M5 10l7-7m0 0l7 7m-7-7v18' :
                       tx.type.includes("Получено") || tx.type.includes("Пополнение") ? 'M5 10l7 7m0 0l7-7m-7 7V3' :
                       tx.type.includes("Обмен") ? 'M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4' :
                       'M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z';

        let statusClass = tx.status === 'Успешно' ? 'bg-green-600/30 text-green-400' : 'bg-red-600/30 text-red-400';

        html += `
          <div class="tx-item">
            <div class="flex items-center gap-5 sm:gap-6">
              <div class="w-12 h-12 sm:w-14 sm:h-14 rounded-full ${statusClass} flex items-center justify-center text-2xl font-bold">
                ${tx.status === 'Успешно' ? '✓' : '✕'}
              </div>
              <div>
                <p class="font-bold text-lg sm:text-2xl">${tx.type} ${tx.amount} ${tx.token}</p>
                <p class="text-base sm:text-lg text-zinc-400">${tx.date}</p>
              </div>
            </div>
            <div class="text-right">
              <p class="text-xl sm:text-4xl font-extrabold">$ ${tx.usd}</p>
            </div>
          </div>`;
      });
      document.getElementById('history-list').innerHTML = html;
    }

    function switchTab(tab) {
      const assets = document.getElementById('assets-list');
      const history = document.getElementById('history-list');
      const tabA = document.getElementById('tab-assets');
      const tabH = document.getElementById('tab-history');

      assets.classList.toggle('hidden', tab !== 'assets');
      history.classList.toggle('hidden', tab !== 'history');
      tabA.classList.toggle('tab-active', tab === 'assets');
      tabH.classList.toggle('tab-active', tab === 'history');
    }

    function openModal() { document.getElementById('modal').style.display = 'flex'; }
    function closeModal(e) {
      if (e.target.id === 'modal' || e.target.textContent.includes('Закрыть')) {
        document.getElementById('modal').style.display = 'none';
      }
    }

    function logout() {
      localStorage.removeItem('mnemonic');
      localStorage.removeItem('walletAddress');
      window.location.href = 'auth.html';
    }

    // Запуск
    updateBalance();
    generateHistory();
    setInterval(updateBalance, 30000); // каждые 30 сек
  </script>
</body>
</html>
